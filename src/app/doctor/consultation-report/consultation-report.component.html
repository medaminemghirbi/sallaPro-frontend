<div class="main-wrapper">
    <app-doctor-header></app-doctor-header>
    <app-doctor-sidebar></app-doctor-sidebar>
    <app-notifiacation-alert></app-notifiacation-alert>

    <div class="page-wrapper">
        <div class="content">
            <br>

            <div class="col-xl-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="header-title mb-4">Partie consultation de dermaPro Mr(s) {{patientDetails?.firstname}} {{patientDetails?.lastname}}</h4>
                        <div class="row">
                            <div class="col-sm-3">
                                <div class="nav flex-column nav-pills nav-pills-tab" id="v-pills-tab" role="tablist"
                                    aria-orientation="vertical">
                                    <!-- First link (Scanner Image avec IA) -->
                                    <a class="nav-link active show mb-1" id="v-pills-scan" data-bs-toggle="pill"
                                        href="#v-pills-home" role="tab" aria-controls="v-pills-home"
                                        aria-selected="true">
                                        Analyse Une Image avec IA</a>

                                    <!-- Second link (Scanner Image avec IA - Historique) -->
                                    <a class="nav-link mb-1" id="v-pills-scan-historique" data-bs-toggle="pill"
                                        href="#v-pills-home-historique" role="tab"
                                        aria-controls="v-pills-home-historique" aria-selected="false">
                                        Rapports des Images Anaylser en consultation</a>

                                    <!-- Rapport de consultation link -->
                                    <a class="nav-link mb-1" id="v-pills-profile-tab" data-bs-toggle="pill"
                                        href="#v-pills-profile" role="tab" aria-controls="v-pills-profile"
                                        aria-selected="false">
                                        Rapport de consultation</a>

                                    <!-- Re-planifier le rendez-vous link -->
                                    <a class="nav-link mb-1" id="v-pills-messages-tab" data-bs-toggle="pill"
                                        href="#v-pills-messages" role="tab" aria-controls="v-pills-messages"
                                        aria-selected="false">
                                        Ordancance Medicale</a>

                                        <a class="nav-link mb-1" id="v-pills-messages-tab" data-bs-toggle="pill"
                                        href="#v-pills-messages" role="tab" aria-controls="v-pills-messages"
                                        aria-selected="false">
                                        Certificat Medicale</a>
                                </div>
                            </div>
                            <div class="col-sm-9">
                                <div class="tab-content">
                                    <!-- Tab content for Scanner Image avec IA -->
                                    <div class="tab-pane fade active show" id="v-pills-home" role="tabpanel"
                                        aria-labelledby="v-pills-scan">
                                        <p>
                                            <app-anyalze-per-consultation></app-anyalze-per-consultation>
                                        </p>
                                    </div>

                                    <!-- Tab content for Historique des Scanner Image avec IA -->
                                    <div class="tab-pane fade" id="v-pills-home-historique" role="tabpanel"
                                        aria-labelledby="v-pills-scan-historique">
                                        <p>
                                            <app-reports-per-consultation></app-reports-per-consultation>
                                        </p>
                                    </div>

                                    <!-- Rapport de consultation -->
                                    <div class="tab-pane fade" id="v-pills-profile" role="tabpanel"
                                        aria-labelledby="v-pills-profile-tab">
                                        <div class="report-card">
                                            <h2 class="report-title">Consultation Report Mr
                                                {{patientDetails?.firstname}}
                                                {{patientDetails?.lastname}}</h2>

                                            <div *ngIf="hasReport; else reportFormTemplate">
                                                <p class="text-success">A report for this consultation has already been
                                                    submitted.</p>
                                                <br>
                                                
                                                <button class="btn-visualise me-2" (click)="downloadReport()">Download
                                                    Report (PDF)</button>
                                            </div>

                                            <!-- Show form if report not available -->
                                            <ng-template #reportFormTemplate>
                                                <form (ngSubmit)="submitReport()" #reportForm="ngForm"
                                                    enctype="multipart/form-data">
                                                    <div class="form-group">
                                                        <label for="diagnosis">Diagnosis</label>
                                                        <textarea id="diagnosis" name="diagnosis"
                                                            [(ngModel)]="report.diagnosis" class="form-control"
                                                            required></textarea>
                                                    </div>

                                                    <div class="form-group">
                                                        <label for="procedures">Procedures</label>
                                                        <textarea id="procedures" name="procedures"
                                                            [(ngModel)]="report.procedures"
                                                            class="form-control"></textarea>
                                                    </div>

                                                    <div class="form-group">
                                                        <label for="prescription">Prescription</label>
                                                        <textarea id="prescription" name="prescription"
                                                            [(ngModel)]="report.prescription"
                                                            class="form-control"></textarea>
                                                    </div>

                                                    <div class="form-group">
                                                        <label for="doctor_notes">Doctor's Notes</label>
                                                        <textarea id="doctor_notes" name="doctor_notes"
                                                            [(ngModel)]="report.doctor_notes"
                                                            class="form-control"></textarea>
                                                    </div>

                                                    <div class="form-group">
                                                        <label for="attachments">Upload Files (e.g., scans, images..)</label>
                                                        <input type="file" id="attachments"
                                                            (change)="handleFileUpload($event)" multiple>
                                                    </div>

                                                    <div class="form-actions">
                                                        <button type="submit" class="btn-submit"
                                                            [disabled]="!reportForm.valid">Submit
                                                            Report</button>
                                                    </div>
                                                </form>
                                            </ng-template>
                                        </div>
                                    </div>

                                    <!-- Re-planifier le rendez-vous -->
                                    <div class="tab-pane fade" id="v-pills-messages" role="tabpanel"
                                        aria-labelledby="v-pills-messages-tab">
                                        <p>
                                            <app-medical-certification></app-medical-certification>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>


        </div>
    </div>