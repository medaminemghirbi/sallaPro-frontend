<div class="main-wrapper">

  <!-- Header -->
  <app-header-superadmin></app-header-superadmin>
  <!-- /Header -->
  <ng-progress #progressBar></ng-progress>

  <!-- Sidebar -->
  <app-sidebar-superadmin></app-sidebar-superadmin>
  <!-- /Sidebar -->

  <!-- Page Wrapper -->
  <div class="page-wrapper">
    <div class="content container-fluid">

      <!-- Page Header -->
      <div class="page-header mb-4">
        <div class="row align-items-center">

          <!-- Title -->
          <div class="col-md-3">
            <h3 class="page-title mb-0">
              {{ 'CATEGORIES.CATEGORIES_COUNT' | translate:{count: categories?.length} }}
            </h3>
          </div>

          <!-- Search box -->
          <div class="col-md-4">
            <input type="text" class="form-control" placeholder="{{ 'CATEGORIES.SEARCH_PLACEHOLDER' | translate }}"
              [(ngModel)]="searchTerm" />
          </div>

          <!-- Page size selector -->
          <div class="col-md-2">
            <select class="form-select" [(ngModel)]="pageSize" (ngModelChange)="p = 1">
              <option value="5">5</option>
              <option value="10">10</option>
              <option value="20">20</option>
            </select>
          </div>

          <!-- Add New button -->
          <div class="col-md-3 text-end">
            <button (click)="openAddModal()" class="btn btn-primary">
              <i class="fa fa-plus me-1"></i> {{ 'CATEGORIES.ADD_NEW_CATEGORY' | translate }}
            </button>
          </div>

        </div>
      </div>
      <!-- /Page Header -->

      <!-- Table -->
      <div class="row">
        <div class="col-sm-12">
          <div class="card">
            <div class="card-body">
              <div class="table-responsive">

                <!-- Loading Animation -->
                <div *ngIf="loading" class="text-center my-3">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>

                <!-- Table -->
                <table *ngIf="!loading && filteredCategories.length > 0"
                  class="datatable table table-hover table-center mb-0">
                  <thead>
                    <tr>
                      <th>{{ 'CATEGORIES.TABLE.RESOURCE_TYPE' | translate }}</th>
                      <th>{{ 'CATEGORIES.TABLE.NAME' | translate }}</th>
                      <th>{{ 'CATEGORIES.TABLE.KEY' | translate }}</th>
                      <th>{{ 'CATEGORIES.TABLE.CREATED_AT' | translate }}</th>
                      <th>{{ 'CATEGORIES.TABLE.DESCRIPTION' | translate }}</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      *ngFor="let category of filteredCategories | paginate: { itemsPerPage: pageSize, currentPage: p }">
                      <td>
                        <span class="badge d-inline-flex align-items-center gap-1"
                          [ngClass]="resourceTypeClass[category.resource_type] || 'bg-success'">
                          <i class="fa" [ngClass]="resourceTypeIcon[category.resource_type] || 'fa-archive'"></i>
                          {{ category.resource_type }}
                        </span>

                      </td>

                      <td>{{ category.name }}</td>
                      <td>{{ category.key }}</td>
                      <td>
                        {{ category.created_at | date:'dd' }}
                        {{ category.created_at | date:'MMMM' }}
                        {{ category.created_at | date:'yyyy' }}<br>
                        <small>at {{ category.created_at | date:'HH:mm' }}</small>
                      </td>
                      <td class="description-cell">{{ category.description }}</td>
                    </tr>
                  </tbody>
                </table>

                <!-- No Data Found -->
                <div *ngIf="!loading && filteredCategories.length === 0" class="text-center my-3">
                  <i class="fa fa-exclamation-circle me-2"></i>No data found.
                </div>

              </div>
            </div>
          </div>

          <!-- Pagination Controls -->
          <div style="text-align:right; margin-top: 10px;">
            <pagination-controls (pageChange)="p = $event"></pagination-controls>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Add/Edit Category Modal -->
<div class="modal fade" tabindex="-1" [ngClass]="{'show d-block': showModal}"
  [style.display]="showModal ? 'block' : 'none'">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ isEdit ? 'Edit Category' : 'Add New Category' }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <form #categoryForm="ngForm">
          <!-- Resource Type -->
          <div class="mb-3">
            <label for="resourceType" class="form-label">Resource Type</label>
            <ng-select [items]="resourceTypes" bindLabel="name" [(ngModel)]="selectedResourceType" name="resourceType"
              [searchable]="true" placeholder="Select or add new" [addTag]="true">
            </ng-select>
          </div>

          <!-- Name -->
          <div class="mb-3">
            <label for="categoryName" class="form-label">Category Name</label>
            <input type="text" class="form-control" [(ngModel)]="newCategory.name" name="name" required>
          </div>

          <!-- Key -->
          <div class="mb-3">
            <label for="categoryKey" class="form-label">Key</label>
            <input type="text" class="form-control" [(ngModel)]="newCategory.key" name="key" required>
          </div>

          <!-- Description -->
          <div class="mb-3">
            <label for="categoryDesc" class="form-label">Description</label>
            <textarea class="form-control" [(ngModel)]="newCategory.description" name="description"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="btn btn-primary" (click)="saveCategory()">Save</button>
      </div>
    </div>
  </div>
</div>
