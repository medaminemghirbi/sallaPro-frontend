<div class="main-wrapper">

    <!-- Header -->
    <app-header-superadmin></app-header-superadmin>
    <ng-progress #progressBar></ng-progress>

    <!-- Sidebar -->
    <app-sidebar-superadmin></app-sidebar-superadmin>

    <!-- Page Wrapper -->
    <div class="page-wrapper">
        <div class="content container-fluid">

            <!-- Page Header -->
            <div class="page-header mb-4">
                <div class="row align-items-center">

                    <!-- Title -->
                    <div class="col-md-3">
                        <h3 class="page-title mb-0">
                            Companies ({{ companies?.length }})
                        </h3>
                    </div>

                    <!-- Search box -->
                    <div class="col-md-4">
                        <input type="text" class="form-control" placeholder="Search..." [(ngModel)]="searchTerm" />
                    </div>

                    <!-- Page size selector -->
                    <div class="col-md-2">
                        <select class="form-select" [(ngModel)]="pageSize" (ngModelChange)="p = 1">
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="20">20</option>
                        </select>
                    </div>

                    <!-- Add New button -->
                    <div class="col-md-3 text-end">
                        <button routerLink="/superadmin/companies/add-new-company" class="btn btn-primary">
                            <i class="fa fa-plus me-1"></i> Add New Company
                        </button>
                    </div>

                </div>
            </div>
            <!-- /Page Header -->

            <!-- Table -->
            <div class="row">
                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">

                                <!-- Loading -->
                                <div *ngIf="loading" class="text-center my-3">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>

                                <!-- Table -->
                                <table *ngIf="!loading && filteredCompanies.length > 0"
                                    class="datatable table table-hover table-center mb-0">
                                    <thead>
                                        <tr>
                                            <th>Company Name</th>
                                            <th>Responsible Person</th>
                                            <th>Billing Address</th>
                                            <th>Created At</th>
                                            <th>Description</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr
                                            *ngFor="let company of filteredCompanies | paginate: { itemsPerPage: pageSize, currentPage: p }">
                                            <td>{{ company.name }}</td>
                                            <td>{{ company.admin?.firstname }} {{ company.admin?.lastname }}</td>
                                            <td>
                                                {{ company.billing_address || company.admin?.email }}
                                            </td>
                                            <td>
                                                {{ company.created_at | date:'dd MMMM yyyy' }}<br>
                                                <small>at {{ company.created_at | date:'HH:mm' }}</small>
                                            </td>
                                            <td class="description-cell">{{ company.description || '-' }}</td>
                                            <td>
                                                <button class="btn btn-sm btn-info me-1"
                                                    [routerLink]="['/superadmin/companies', company.id, 'company-details']"
                                                    title="View Info">
                                                    <i class="fa fa-eye"></i>
                                                </button>
                                                <!-- Edit button -->
                                                <button class="btn btn-sm btn-success me-1" title="Edit"
                                                    (click)="goToCompanyDetails(company.id)">
                                                    <i class="fa fa-pencil-alt"></i>
                                                </button>


                                                <!-- Delete button -->
                                                <button class="btn btn-sm btn-danger" title="Delete">
                                                    <i class="fa fa-trash"></i>
                                                </button>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>

                                <!-- No Data Found -->
                                <div *ngIf="!loading && filteredCompanies.length === 0" class="text-center my-3">
                                    <i class="fa fa-exclamation-circle me-2"></i>No data found.
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- Pagination Controls -->
                    <div class="text-end mt-2">
                        <pagination-controls (pageChange)="p = $event"></pagination-controls>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
