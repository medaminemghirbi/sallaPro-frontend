<div class="main-wrapper">

  <app-header-admin></app-header-admin>
  <ng-progress #progressBar></ng-progress>
  <app-sidebar-admin></app-sidebar-admin>

  <div class="page-wrapper">
    <div class="content container-fluid">

      <!-- Page Header -->
      <div class="page-header mb-4">
        <h3 class="page-title">{{ 'CLIENTS.ADD_NEW_CLIENT' | translate }}</h3>
      </div>

      <!-- Form Card -->
      <div class="card shadow-sm p-4">

        <form [formGroup]="clientForm" (ngSubmit)="onSubmit()">

          <div class="row g-4">

            <!-- Client Info -->
            <div class="col-md-6 col-12">
              <h5 class="mb-3 border-bottom pb-2">{{ 'CLIENTS.CLIENT_INFO' | translate }}</h5>

              <div class="mb-3">
                <label class="form-label">{{ 'CLIENTS.FIRST_NAME' | translate }}</label>
                <input class="form-control" formControlName="firstname">
              </div>

              <div class="mb-3">
                <label class="form-label">{{ 'CLIENTS.LAST_NAME' | translate }}</label>
                <input class="form-control" formControlName="lastname">
              </div>

              <div class="mb-3">
                <label class="form-label">{{ 'CLIENTS.EMAIL' | translate }}</label>
                <input type="email" class="form-control" formControlName="email">
              </div>

              <div class="mb-3">
                <label class="form-label">{{ 'CLIENTS.PHONE_NUMBER' | translate }}</label>
                <input type="text" class="form-control" formControlName="phone_number">
              </div>

              <!-- Birthday -->
              <div class="mb-3">
                <label class="form-label">{{ 'CLIENTS.BIRTHDAY' | translate }}</label>
                <input type="date" class="form-control" formControlName="birthday">
              </div>



            </div>

            <!-- Security Info -->
            <div class="col-md-6 col-12">
              <h5 class="mb-3 border-bottom pb-2">{{ 'CLIENTS.SECURITY' | translate }}</h5>

              <div class="mb-3">
                <label class="form-label">{{ 'CLIENTS.PASSWORD' | translate }}</label>
                <input type="password" class="form-control" formControlName="password">
              </div>

              <div class="mb-3">
                <label class="form-label">{{ 'CLIENTS.CONFIRM_PASSWORD' | translate }}</label>
                <input type="password" class="form-control" formControlName="password_confirmation">
              </div>

              <hr>
              <h5 class="mb-3 border-bottom pb-2">{{ 'CLIENTS.LOCATION' | translate }}</h5>


              <!-- Address Options -->
              <div class="mb-3">
                <label class="form-label">{{ 'CLIENTS.ADDRESS' | translate }}</label>

                <div class="btn-group w-100 mb-3" role="group">
                  <button type="button" class="btn" [class.btn-primary]="addressOption === 'manual'"
                    [class.btn-outline-primary]="addressOption !== 'manual'" (click)="addressOption = 'manual'">
                    <i class="feather icon-edit-3 me-2"></i>{{ 'CLIENTS.MANUAL_ADDRESS' | translate }}
                  </button>
                  <button type="button" class="btn" [class.btn-primary]="addressOption === 'map'"
                    [class.btn-outline-primary]="addressOption !== 'map'" (click)="addressOption = 'map'">
                    <i class="feather icon-map-pin me-2"></i>{{ 'CLIENTS.MAP_ADDRESS' | translate }}
                  </button>
                </div>

                <!-- Manual input -->
                <textarea *ngIf="addressOption === 'manual'" rows="3" class="form-control" formControlName="address"
                  placeholder="{{ 'CLIENTS.ENTER_MANUAL_ADDRESS' | translate }}"></textarea>

                <!-- Google Maps -->
                <div *ngIf="addressOption === 'map'" class="map-wrapper">
                  <div class="alert alert-info alert-sm mb-2">
                    <i class="feather icon-info me-2"></i> {{ 'CLIENTS.MAP_ADDRESS_INSTRUCTION' | translate }}
                  </div>
                  <div class="map-container">
                    <app-map-picker [selectionMode]="true"
                      (locationSelected)="onLocationSelected($event)"></app-map-picker>
                  </div>
                  <input class="form-control mt-2" placeholder="{{ 'CLIENTS.SELECTED_ADDRESS' | translate }}"
                    [value]="addressFromMap" readonly>
                </div>
              </div>

              <!-- Country Field (Auto-filled from map) -->
              <div class="mb-3" *ngIf="clientForm.get('country')?.value">
                <label class="form-label">{{ 'CLIENTS.COUNTRY' | translate }}</label>
                <input type="text" class="form-control" formControlName="country" readonly>
              </div>

              <!-- Hidden Latitude and Longitude Fields (sent to backend but not displayed) -->
              <input type="hidden" formControlName="latitude">
              <input type="hidden" formControlName="longitude">

            </div>
          </div>

          <!-- Submit Button -->
          <div class="mt-4 text-end">
            <button class="btn btn-primary px-4" [disabled]="clientForm.invalid || isLoading">
              {{ isLoading ? ('CLIENTS.SAVING' | translate) : ('CLIENTS.SAVE_CLIENT' | translate) }}
            </button>
          </div>

        </form>
      </div>

    </div>
  </div>

</div>
