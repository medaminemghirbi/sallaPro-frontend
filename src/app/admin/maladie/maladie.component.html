<div class="main-wrapper">
    <app-header-admin></app-header-admin>
    <app-sidebar-admin></app-sidebar-admin>
    <ng-progress #progressBar></ng-progress>

    <div class="page-wrapper">
        <div class="content">
            <div class="card">
                <div class="card-header">
                    <h6 class="tip text-center mb-3">
                        The AI model has been trained on the diseases listed below based on reliable annotated data. 
                        Updating or adding diseases may require retraining the model.
                        <br>
                        so contact developer : mohamed.amine.mghirbi&#64;gmail.com
                    </h6>
                    <div class="d-flex justify-content-between align-items-center">
                        <!-- Left: Search -->
                        <div class="search-bar w-50 me-2">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Search diseases..." [(ngModel)]="searchText">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <!-- Right: Filter -->
                        <div class="form-group mb-0">
                            <select class="form-select" [(ngModel)]="itemsPerPage">
                                <option [value]="5">5 per page</option>
                                <option [value]="10">10 per page</option>
                                <option [value]="25">25 per page</option>
                                <option [value]="100">100 per page</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="thead-light">
                                <tr>
                                    <th width="5%">#</th>
                                    <th width="15%">Image</th>
                                    <th width="20%">Disease</th>
                                    <th width="20%">Description</th>
                                    <th width="10%">Cancer</th>
                                    <th width="20%">Key Info</th>
                                    <th width="10%">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let maladie of maladies | paginate: { itemsPerPage: itemsPerPage, currentPage: p } | filter:searchText; index as i">
                                    <td>{{ (p - 1) * itemsPerPage + i + 1 }}</td>
                                    <td>
                                        <img [src]="maladie.diseas_image_url" class="img-thumbnail" 
                                             onerror="this.src='https://via.placeholder.com/100x60?text=No+Image'">
                                    </td>
                                    <td>
                                        <strong style="color: #390d74;">{{ maladie.order }} - {{ maladie.maladie_name }}</strong>
                                    </td>
                                    <td>{{ maladie.maladie_description }}</td>
                                    <td>
                                        <span class="badge" [ngClass]="{'bg-danger': maladie.is_cancer, 'bg-success': !maladie.is_cancer}">
                                            {{ maladie.is_cancer ? 'Yes' : 'No' }}
                                        </span>
                                    </td>
                                    <td>
                                        <div><small><strong>Causes:</strong> {{ maladie.causes}}</small></div>
                                        <div><small><strong>Symptoms:</strong> {{ maladie.symptoms }}</small></div>
                                    </td>
                                    <td>
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" 
                                                    type="button" data-bs-toggle="dropdown">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                <li>
                                                    <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#con-close-modal" 
                                                       (click)="getdata(maladie)">
                                                        <i class="fas fa-cog text-primary me-2"></i>Update
                                                    </a>
                                                </li>
                                                <li>
                                                    <a class="dropdown-item" [routerLink]="['/disease-details', maladie.id]">
                                                        <i class="fas fa-eye text-info me-2"></i>View Details
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="text-align:right;">
                        <pagination-controls (pageChange)="p = $event"></pagination-controls>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for updating maladie -->
        <div class="modal fade" id="con-close-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Update Information for: <strong>{{ dataMaladie.maladie_name }}</strong></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form [formGroup]="update" (ngSubmit)="updateMaladie()">
                            <div class="form-group">
                                <label for="maladie_name">Name</label>
                                <input type="text" id="maladie_name" formControlName="maladie_name" class="form-control"
                                    required />
                            </div>
                            <div class="form-group">
                                <label for="maladie_description">Description</label>
                                <textarea id="maladie_description" formControlName="maladie_description"
                                    class="form-control" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="causes">Causes</label>
                                <textarea id="causes" formControlName="causes" class="form-control" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="symptoms">Symptoms</label>
                                <textarea id="symptoms" formControlName="symptoms" class="form-control" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="prevention">Prevention</label>
                                <textarea id="prevention" formControlName="prevention" class="form-control"
                                    rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="treatments">Treatments</label>
                                <textarea id="treatments" formControlName="treatments" class="form-control"
                                    rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="references">References</label>
                                <input type="url" id="references" formControlName="references" class="form-control" />
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary">Save changes</button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>