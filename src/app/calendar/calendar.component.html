<!-- Header -->
<app-header-admin></app-header-admin>
<!-- /Header -->

<!-- Sidebar -->
<app-sidebar-admin></app-sidebar-admin>
<!-- /Sidebar -->

<div class="page-wrapper">

    <div class="content container-fluid">

      <ng-progress #progressBar></ng-progress>

      <!-- Month and Year Selector -->
      <div class="row mb-3" style="margin-bottom: 20px;">
        <div class="col-md-6">
          <div class="form-group">
            <label for="monthSelect" class="form-label">{{ 'CALENDAR.SELECT_MONTH' | translate }}</label>
            <select id="monthSelect" class="form-control" [(ngModel)]="selectedMonth" (change)="onMonthChange($event)">
              <option *ngFor="let month of months; let i = index" [value]="i">
                {{ month }}
              </option>
            </select>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="yearSelect" class="form-label">{{ 'CALENDAR.SELECT_YEAR' | translate }}</label>
            <select id="yearSelect" class="form-control" [(ngModel)]="selectedYear" (change)="onYearChange($event)">
              <option *ngFor="let year of availableYears" [value]="year">
                {{ year }}
              </option>
            </select>
          </div>
        </div>
      </div>
      <!-- /Month and Year Selector -->

      <full-calendar #calendar *ngIf="calendarVisible" [options]="calendarOptions">

        <ng-template #eventContent let-arg>
          <b>{{ arg.timeText }}</b>
          <i>{{ arg.event.title }}</i>
        </ng-template>
      </full-calendar>

      <!-- Context Menu -->
      <div *ngIf="showContextMenu" 
           class="context-menu"
           [style.left.px]="contextMenuX" 
           [style.top.px]="contextMenuY"
           (click)="$event.stopPropagation()">
        
        <!-- Event Context Menu -->
        <div *ngIf="contextMenuType === 'event'" class="context-menu-items">
          <div class="context-menu-item" (click)="viewEventDetails()">
            <i class="fa fa-eye me-2"></i>
            {{ 'CALENDAR.VIEW_DETAILS' | translate }}
          </div>
          <div class="context-menu-item" (click)="editEvent()">
            <i class="fa fa-edit me-2"></i>
            {{ 'CALENDAR.EDIT' | translate }}
          </div>
          <div class="context-menu-divider"></div>
          <div class="context-menu-item danger" (click)="deleteEvent()">
            <i class="fa fa-trash me-2"></i>
            {{ 'CALENDAR.DELETE' | translate }}
          </div>
        </div>

        <!-- Slot Context Menu -->
        <div *ngIf="contextMenuType === 'slot'" class="context-menu-items">
          <div class="context-menu-item" (click)="addNewEvent()">
            <i class="fa fa-plus me-2"></i>
            {{ 'CALENDAR.ADD_EVENT' | translate }}
          </div>
        </div>
      </div>

      <!-- Overlay to close context menu -->
      <div *ngIf="showContextMenu" class="context-menu-overlay" (click)="closeContextMenu()"></div>

      <!-- Event Creation Modal -->
      <div class="modal fade" [class.show]="showEventModal" [style.display]="showEventModal ? 'block' : 'none'" 
           tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">{{ 'CALENDAR.CREATE_EVENT' | translate }}</h5>
              <button type="button" class="btn-close" (click)="closeEventModal()" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form>
                <div class="mb-3">
                  <label class="form-label">{{ 'CALENDAR.EVENT_TITLE' | translate }}</label>
                  <input type="text" class="form-control" [(ngModel)]="eventForm.title" 
                         name="title" placeholder="{{ 'CALENDAR.ENTER_TITLE' | translate }}" required>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label class="form-label">{{ 'CALENDAR.START_TIME' | translate }}</label>
                    <input type="datetime-local" class="form-control" [(ngModel)]="eventForm.start" 
                           name="start" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">{{ 'CALENDAR.END_TIME' | translate }}</label>
                    <input type="datetime-local" class="form-control" [(ngModel)]="eventForm.end" 
                           name="end" required>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label">{{ 'CALENDAR.DESCRIPTION' | translate }}</label>
                  <textarea class="form-control" rows="3" [(ngModel)]="eventForm.description" 
                            name="description" placeholder="{{ 'CALENDAR.ENTER_DESCRIPTION' | translate }}"></textarea>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" (click)="closeEventModal()">
                {{ 'CALENDAR.CANCEL' | translate }}
              </button>
              <button type="button" class="btn btn-primary" (click)="saveEvent()">
                {{ 'CALENDAR.SAVE_EVENT' | translate }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal Backdrop -->
      <div *ngIf="showEventModal" class="modal-backdrop fade show"></div>

    </div>
  </div>
